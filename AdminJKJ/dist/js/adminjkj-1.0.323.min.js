function validateAddMethod(){jQuery.validator.addMethod("password2",function(a,b){return this.optional(b)||/^(?:(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])).{6,}$/.test(a)},"请输入不少于6位且包含数字、小写字母和大写字母"),jQuery.validator.addMethod("ip",function(a,b){return this.optional(b)||/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/.test(a)&&RegExp.$1<256&&RegExp.$2<256&&RegExp.$3<256&&RegExp.$4<256},"请输入合法的IP地址"),jQuery.validator.addMethod("abc",function(a,b){return this.optional(b)||/^[a-zA-Z0-9_@.]*$/.test(a)},"请输入字母数字或下划线"),jQuery.validator.addMethod("noEqualTo",function(a,b,c){return a!=$(c).val()},"请再次输入不同的值"),jQuery.validator.addMethod("chinese",function(a,b){return this.optional(b)||/^[\u4e00-\u9fa5]*$/.test(a)},"请填写中文"),jQuery.validator.addMethod("ch-en",function(a,b){return this.optional(b)||/^([\u4e00-\u9fa5]|[a-zA-Z])*$/.test(a)},"请填写中文或英文字符"),jQuery.validator.addMethod("realName",function(a,b){return this.optional(b)||/^[\u4e00-\u9fa5]{2,30}$/.test(a)},"姓名只能为2-30个汉字"),jQuery.validator.addMethod("mobile",function(a,b){return this.optional(b)||/^1\d{10}$/.test(a)},"请正确填写手机号码"),jQuery.validator.addMethod("phone",function(a,b){var c=/^(\d{3,4}-?)?\d{7,9}$/g;return this.optional(b)||c.test(a)},"请正确填写电话号码"),jQuery.validator.addMethod("fax",function(a,b){var c=/^([+]{0,1}((\d){1,6})([ ]?))?([-]?[0-9]{1,12})+$/g;return this.optional(b)||c.test(a)},"请正确填写传真号码"),jQuery.validator.addMethod("zipCode",function(a,b){var c=/^[0-9]{6}$/;return this.optional(b)||c.test(a)},"请正确填写邮政编码"),jQuery.validator.addMethod("qq",function(a,b){var c=/^[1-9][0-9]{4,}$/;return this.optional(b)||c.test(a)},"请正确填写QQ号码"),jQuery.validator.addMethod("money",function(a,b){var c=/(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]([0-9])?$)/;return this.optional(b)||c.test(a)},"请正确填写金额数"),jQuery.validator.addMethod("idCardNo",function(a,b){var c=function(a){a=a.toString();var b,c,d,e,f,g=[!0,!1,!1,!1,!1],h={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"},i=[];if(i=a.split(""),null==h[parseInt(a.substr(0,2))])return g[4];switch(a.length){case 15:return f=(parseInt(a.substr(6,2))+1900)%4===0||(parseInt(a.substr(6,2))+1900)%100===0&&(parseInt(a.substr(6,2))+1900)%4===0?/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}$/:/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}$/,f.test(a)?g[0]:g[2];case 18:return f=parseInt(a.substr(6,4))%4==0||parseInt(a.substr(6,4))%100===0&&parseInt(a.substr(6,4))%4===0?/^[1-9][0-9]{5}19[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}[0-9Xx]$/:/^[1-9][0-9]{5}19[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}[0-9Xx]$/,f.test(a)?(d=7*(parseInt(i[0])+parseInt(i[10]))+9*(parseInt(i[1])+parseInt(i[11]))+10*(parseInt(i[2])+parseInt(i[12]))+5*(parseInt(i[3])+parseInt(i[13]))+8*(parseInt(i[4])+parseInt(i[14]))+4*(parseInt(i[5])+parseInt(i[15]))+2*(parseInt(i[6])+parseInt(i[16]))+parseInt(i[7])+6*parseInt(i[8])+3*parseInt(i[9]),b=d%11,e="F",c="10X98765432",e=c.substr(b,1),e===i[17]?g[0]:g[3]):g[2];default:return g[1]}};return this.optional(b)||c(a)},"请正确填写身份证号码")}if("undefined"==typeof jQuery)throw new Error("adminjkj.js 依赖 jQuery");$.jkj={data:{app:{},page:{}},options:{animationSpeed:500,sidebarToggleSelector:"[data-toggle='offcanvas']",sidebarPushMenu:!0,sidebarSlimScroll:!0,sidebarExpandOnHover:!1,enableControlTreeView:!0,enableControlSidebar:!0,controlSidebarOptions:{toggleBtnSelector:"[data-toggle='control-sidebar']",selector:".control-sidebar",slide:!0},screenSizes:{xs:480,sm:768,md:992,lg:1200}}},$.fn.jkj=function(a,b){return new $.jkj[a](b,this)},$.jkj.core={getAppData:function(){var a;return a=$.jkj.data.app,window.top===window.self?null!=window.opener&&window.opener.window.$.jkj&&(a=window.opener.window.$.jkj.core.getAppData()):window.top.window.$.jkj&&(a=window.top.window.$.jkj.data.app),a},layout:{activate:function(){var a=this;a.fix(),a.fixSidebar(),$("body, html, .wrapper").css("height","auto"),$(window,".wrapper").resize(function(){a.fix(),a.fixSidebar()})},fix:function(){$(".layout-boxed > .wrapper").css("overflow","hidden");var a=$(".main-footer").outerHeight()||0,b=$(".main-header").outerHeight()+a,c=$(window).height(),d=$(".sidebar").height()||0;if($("body").hasClass("fixed"))$(".content-wrapper, .right-side").css("min-height",c-a);else{var e;c>=d?($(".content-wrapper, .right-side").css("min-height",c-b),e=c-b):($(".content-wrapper, .right-side").css("min-height",d),e=d);var f=$($.jkj.options.controlSidebarOptions.selector);"undefined"!=typeof f&&f.height()>e&&$(".content-wrapper, .right-side").css("min-height",f.height())}},fixSidebar:function(){return $("body").hasClass("fixed")?("undefined"==typeof $.fn.slimScroll&&window.console&&window.console.error("Error: the fixed layout requires the slimscroll plugin!"),void($.jkj.options.sidebarSlimScroll&&"undefined"!=typeof $.fn.slimScroll&&($(".sidebar").slimScroll({destroy:!0}).height("auto"),$(".sidebar").slimScroll({height:$(window).height()-$(".main-header").height()+"px",color:"rgba(0,0,0,0.2)",size:"3px"})))):void("undefined"!=typeof $.fn.slimScroll&&$(".sidebar").slimScroll({destroy:!0}).height("auto"))}},pushMenu:{activate:function(a){var b=$.jkj.options.screenSizes;$(document).on("click",a,function(a){a.preventDefault(),$(window).width()>b.sm-1?$("body").hasClass("sidebar-collapse")?$("body").removeClass("sidebar-collapse").trigger("expanded.pushMenu"):$("body").addClass("sidebar-collapse").trigger("collapsed.pushMenu"):$("body").hasClass("sidebar-open")?$("body").removeClass("sidebar-open").removeClass("sidebar-collapse").trigger("collapsed.pushMenu"):$("body").addClass("sidebar-open").trigger("expanded.pushMenu")}),$(".content-wrapper").click(function(){$(window).width()<=b.sm-1&&$("body").hasClass("sidebar-open")&&$("body").removeClass("sidebar-open")}),($.jkj.options.sidebarExpandOnHover||$("body").hasClass("fixed")&&$("body").hasClass("sidebar-mini"))&&this.expandOnHover()},expandOnHover:function(){var a=this,b=$.jkj.options.screenSizes.sm-1;$(".main-sidebar").hover(function(){$("body").hasClass("sidebar-mini")&&$("body").hasClass("sidebar-collapse")&&$(window).width()>b&&a.expand()},function(){$("body").hasClass("sidebar-mini")&&$("body").hasClass("sidebar-expanded-on-hover")&&$(window).width()>b&&a.collapse()})},expand:function(){$("body").removeClass("sidebar-collapse").addClass("sidebar-expanded-on-hover")},collapse:function(){$("body").hasClass("sidebar-expanded-on-hover")&&$("body").removeClass("sidebar-expanded-on-hover").addClass("sidebar-collapse")}},tree:function(a){var b=this,c=$.jkj.options.animationSpeed;$(document).off("click",a+" li a").on("click",a+" li a",function(a){var d=$(this),e=d.next();if(e.is(".treeview-menu")&&e.is(":visible")&&!$("body").hasClass("sidebar-collapse"))e.slideUp(c,function(){e.removeClass("menu-open")}),e.parent("li").removeClass("active");else if(e.is(".treeview-menu")&&!e.is(":visible")){var f=d.parents("ul").first(),g=f.find("ul:visible").slideUp(c);g.removeClass("menu-open");var h=d.parent("li");e.slideDown(c,function(){e.addClass("menu-open"),f.find("li.active").removeClass("active"),h.addClass("active"),b.layout.fix()})}e.is(".treeview-menu")&&a.preventDefault()})}},$.jkj.util={date:{init:function(){return Date.prototype.format=function(a){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12===0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},c={0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"};a=a||"yyyy-MM-dd hh:mm:ss",/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(a)&&(a=a.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+c[this.getDay()+""]));for(var d in b)new RegExp("("+d+")").test(a)&&(a=a.replace(RegExp.$1,1===RegExp.$1.length?b[d]:("00"+b[d]).substr((""+b[d]).length)));return a},!0},getDate:function(a){return a.toDate()},getTodayStr:function(a){return a=a||"yyyy-MM-dd",(new Date).format(a)}},number:{init:function(){return Number.prototype.bankRound=function(a){var b,c,d,e,f;return a=Math.abs(a||0),b=Math.pow(10,a),e=Math.floor(this*b*100)%10,f=Math.floor(this*b*10)%100,c=0===e&&f/5%2===1&&Math.floor(f/10)%2===0,d=Math.round(this*b)/b,c&&(d=(Math.round(this*b)-1)/b),d},Number.prototype.ceil=function(a){var b,c;return a=Math.abs(a||0),b=Math.pow(10,a),c=Math.ceil(this*b)/b},Number.prototype.floor=function(a){var b,c;return a=Math.abs(a||0),b=Math.pow(10,a),c=Math.floor(this*b)/b},Number.prototype.round=function(a){var b;return a=Math.abs(a||0),b=Math.pow(10,a),Math.round(this*b)/b},!0}},string:{init:function(){return String.prototype.cnLength=function(){return this.replace(/[^\x00-\xff]/g,"**").length},String.prototype.cutString=function(a){return a=a||10,this.length>a?this.substr(0,a)+"...":this.toString()},String.prototype.getNumberInfo=function(a,b){var c,d,e,f,g;if(isNaN(Number(this)))throw new Error("字符串内容不是数值！");return a=Math.abs(a||0),a>0&&(b=b||"floor"),c=this.toString(),g={},c.indexOf(".")>=0?(0===c.indexOf(".")&&(c="0"+c),e=c.split(".")[0],f="0."+c.split(".")[1]):(e=c,f="0.0"),"round"===b?f=Number(f).toFixed(a):"floor"===b?f=Number(f).floor(a).toFixed(a):"ceil"===b?f=Number(f).ceil(a).toFixed(a):"bank"===b&&(f=Number(f).bankRound(a).toFixed(a)),d=e,void 0!==f&&(e=(Number(e)+Number(f[0])).toString(),d=(Number(this)<0&&0===Number(e)?"-":"")+e,f=f.substring(2),d+="."+f),g.lNumber=e,g.rNumber=f,g.stringValue=d,g},String.prototype.getURLParameter=function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)"),c=this.substr(this.indexOf("/?")+1).match(b);return null!=c?unescape(c[2]):null},String.prototype.replaceAll=function(a,b,c){return this.replace(new RegExp(a,c?"gim":"gm"),b)},String.prototype.toChineseNumber=function(a,b){var c,d,e,f,g,h;if(c=this.toString(),h=c.getNumberInfo(a,b),d=["","十","百","千","万","十","百","千","亿","十","百","千","兆","十","百","千"],e=["零","一","二","三","四","五","六","七","八","九"],g=[],$.each(h.lNumber.split("").reverse(),function(a,b){g.push(e[b]+d[a])}),g=g.reverse(),g.length>1){var i;i=g.pop(),"零"!=i&&g.push(i)}return void 0!==h.rNumber&&(g.push("点"),h.rNumber=Number(h.rNumber).toString(),$.each(h.rNumber.split(""),function(a,b){g.push(e[b])})),f=g.join(""),f=f.replace(/零[千百十]/g,"零").replace(/零([兆|亿|万])/g,"$1").replace(/零{2,}/g,"零").replace(/([兆|亿])零/g,"$1").replace(/亿万/,"亿").replace(/兆亿/,"兆")},String.prototype.toCapitalMoney=function(a){var b,c,d,e,f,g;return b=this.toString(),g=b.getNumberInfo(2,a),c=["分","角","元","拾","佰","仟","万","拾","佰","仟","亿","拾","佰","仟","兆","拾","佰","仟"],d=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],f=[],$.each(g.stringValue.replace(".","").split("").reverse(),function(a,b){f.push(d[b]+c[a])}),f=f.reverse(),e=f.join(""),e=e.replace(/零角零分$/g,"整").replace(/零[仟佰拾角分]/g,"零").replace(/零+/g,"零").replace(/零([兆|亿|万|元])/g,"$1").replace(/([兆|亿])零/g,"$1").replace(/亿万/,"亿").replace(/兆亿/,"兆").replace(/零$/,"").replace(/^元/,"零元")},String.prototype.toDate=function(){return new Date(Date.parse(this.replace(/-/g,"/")))},String.prototype.toMoney=function(a,b,c){var d;if(b=b||2,d=this.getNumberInfo(b,a),"string"==typeof c&&c.length>0){var e=/(\d{1,3})(?=(\d{3})+(?:\.))/g;d.stringValue=d.stringValue.replace(e,"$1,")}return d.stringValue},String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},String.prototype.trimAll=function(){return this.replace(/\s+/g,"")},String.prototype.trimLeft=function(){return this.replace(/(^\s*)/g,"")},String.prototype.trimRight=function(){return this.replace(/(\s*$)/g,"")},!0}},random:{basic:function(a,b){var c,d;a=a||4,c=b.length,d="";for(var e=0;e<a;e++)d+=b[Math.floor(Math.random()*c)];return d},getLongDateString:function(){return(new Date).format("yyyyMMddHHmmss")+this.getString(8)},getString:function(a){var b;return b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz123456789",this.basic(a,b)},getSimpleString:function(a){var b;return b="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",this.basic(a,b)}},addFavorite:function(a,b){try{window.external.addFavorite(a,b)}catch(c){try{window.sidebar.addPanel(b,a,"")}catch(a){alert("加入收藏失败，请使用Ctrl+D进行添加")}}},setHomepage:function(a){if(document.all)document.body.style.behavior="url(#default#homepage)",document.body.setHomePage(a);else if(window.sidebar){if(window.netscape)try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(a){alert("该操作被浏览器拒绝，如果想启用该功能，请在地址栏内输入about:config，然后将项 signed.applets.codebase_principal_support 值该为true")}var b=Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch);b.setCharPref("browser.startup.homepage",a)}}},$.jkj.init=function(){var a,b,c,d;return a=this.core,b=this.data,c=this.options,d=this.util,b.app=this.core.getAppData(),$.each(d,function(a,b){void 0!==b.init&&d[a].init()}),a.layout.activate(),c.enableControlTreeView&&a.tree(".sidebar"),c.sidebarPushMenu&&a.pushMenu.activate(c.sidebarToggleSelector),this},$(function(){$.jkj.init()}),$.jkj.beautifyInput=function(a,b){this.settings=$.extend(!0,{},$.jkj.beautifyInput.defaults,a),this.selector=b,this.init()},$.extend($.jkj.beautifyInput,{defaults:{type:"form",class:".beautify-input",beautifyModels:"data-beautify-models",modelInfos:{currency:{roundingMode:"round",scale:2,thousands:",",displayModel:["number"]}}},setDefaults:function(a){$.extend($.jkj.beautifyInput.defaults,a)},prototype:{init:function(){var a=this,b=a.settings,c=a.selector;"form"===b.type?$(c).find(b.class).each(function(){a.element(this)}):$(c).each(function(){a.element(this)})},element:function(a){var b=this,c=b.settings;strArrayModels=$(a).attr(c.beautifyModels).split(","),$.each(strArrayModels,function(b,d){var e=c.modelInfos[d];$.jkj.beautifyInput.models[d](a,e)})}},addModel:function(a,b,c){$.jkj.beautifyInput.models[a]=b,$.jkj.beautifyInput.defaults.modelInfos[a]=c},models:{currency:function(a,b){$(a).popover({animation:!1,placement:"auto top",content:function(){return $(a).attr("data-beautify-input")},trigger:"manual",container:"body"}),$(a).on("focus",{options:b},function(a){a.preventDefault();var b=a.data.options,c=$.trim($(this).val());if(""!=c){var d=c.toMoney(b.roundingMode,b.scale,b.thousands);$(this).attr("data-beautify-input",d)}else $(this).attr("data-beautify-input","");$(this).attr("data-lastValue",c),$(this).popover("show")}).on("blur",{options:b},function(a){a.preventDefault();var b=a.data.options,c=$.trim($(this).val());if(""!=c)if("-"==c)$(this).val("");else{var d=c.toMoney(b.roundingMode,b.scale);$(this).val(d)}$(this).popover("hide")}).on("input",{options:b},function(a){a.preventDefault();var b,c=a.data.options,d=$.trim($(this).val()),e=$(this).attr("data-lastValue"),f=new RegExp(/^((\-)?(([1-9]\d*)|\d))?(\.\d*)?$/);if(b=d.replace(/[^\-\d\.]/g,""),""!==b&&"-"!==b&&(b=b.match(/((\-)?(([1-9]\d*)|\d))?(\.\d*)?/g)[0]),""==b||"-"==b||f.test(b)?($(this).attr("data-lastValue",b),d!==b&&$(this).val(b)):(b=e,$(this).val(e)),""!==b)if("-"===b)$(this).attr("data-beautify-input","-");else{var g=b.toMoney(c.roundingMode,c.scale,c.thousands);$(this).attr("data-beautify-input",g)}else $(this).attr("data-beautify-input",""),$(this).popover("hide");$(this).popover("show")})}}}),$.jkj.blockui={_init:function(a){var b;b={image:"/images/loading.gif",message:"加载中...",zIndex:1e3,overlayColor:"#000",overlayOpacity:.2},a=$.extend(!0,b,a);var c='<div class="loading-message ">';if(c+='<img src="'+a.image+'" align="" width="80px" height="95px"><br/>',c+="<span>"+a.message+"</span>",c+="</div>",a.target){var d=$(a.target);d.height()<=$(window).height()&&(a.cenrerY=!0),d.block({message:c,baseZ:a.zIndex,centerY:void 0!==a.cenrerY&&a.cenrerY,css:{top:"10%",border:"0",padding:"0",backgroundColor:"none"},overlayCSS:{backgroundColor:a.overlayColor,opacity:a.overlayOpacity,cursor:"wait"}})}else $.blockUI({message:c,baseZ:a.zIndex,css:{border:"0",padding:"0",backgroundColor:"none"},overlayCSS:{backgroundColor:a.overlayColor,opacity:a.overlayOpacity,cursor:"wait"}})},show:function(a){this._init(a)},hide:function(a){a?$(a).unblock({onUnblock:function(){$(a).css("position",""),$(a).css("zoom","")}}):$.unblockUI()}},$("[data-xmp]").click(function(){var a=$(this).text();"展开代码"==a?($(this).next("xmp").css("height","auto"),$(this).text("收起代码")):($(this).next("xmp").css("height","100px"),$(this).text("展开代码"))}),$.jkj.dataTable={_init:function(a,b){var c,d;if(!$.fn.dataTable)throw new Error("$.jkj.dataTable 依赖第三方插件 dataTables");return d={jQueryUI:!1,info:!0,lengthChange:!0,ordering:!0,paging:!0,processing:!1,scrollX:!0,scrollY:"",searching:!1,serverSide:!1,stateSave:!0,autoWidth:!0,deferRender:!1,deferLoading:null,destroy:!1,displayStart:0,lengthMenu:[10,20,30,50,100],orderClasses:!0,orderMulti:!1,order:[],pageLength:10,pagingType:"full_numbers",renderer:"bootstrap",search:{caseInsensitive:!1,regex:!1,search:"",smart:!1},searchDelay:350,stateDuration:7200,columnDefs:[{orderable:!1,orderSequence:["desc","asc",""],searchable:!1,targets:"_all"}],language:{aria:{sortAscending:" - 点击返回升序排序",sortDescending:" - 点击返回降序排序"},decimal:"",emptyTable:"未查询到相关数据。",info:"显示 _START_ 到 _END_ 条，共  _TOTAL_ 条",infoEmpty:"显示 0 到 0 条，共 0 条",infoFiltered:" - 过滤前共 _MAX_ 条",infoPostFix:"",lengthMenu:"显示 _MENU_ 条",loadingRecords:"数据正在加载中...",paginate:{first:"首页",last:"末页",next:"后一页",previous:"前一页"},processing:"数据正在加载中...",search:"搜索：",searchPlaceholder:"请输入内容",thousands:",",url:"",zeroRecords:"未查询到相关数据。"}},b=$.extend(!0,d,b),c=$(a).DataTable(b)},local:function(a,b){var c,d;return d={},b=$.extend(!0,d,b),c=this._init(a,b)},remote:function(a,b){var c,d;return d={serverSide:!0,ajax:function(c,d,e){var f=$(a).dataTable().api(!0),g="",h=($.isFunction(b.formId)?b.formId():b.formId)||"";g+="draw="+c.draw,g+="&pageNumber="+(f.page()+1),g+="&pageSize="+f.page.len(),$.each(c.order,function(a,b){g+="&sort["+a+"].property="+encodeURIComponent(c.columns[b.column].data),g+="&sort["+a+"].direction="+b.dir}),h=h.trim(),h.length>0&&(h.indexOf("#")<0&&(h="#"+h),$.each($(h).serializeArray(),function(a,b){g+="&"+b.name+"="+(b.value?encodeURIComponent(b.value):"")})),$.isFunction(b.ajaxMethod)&&b.ajaxMethod(g,d,e)}},b=$.extend(!0,d,b),c=this._init(a,b)}},$.jkj.daterangepicker=function(a,b){var c,d,e,f,g,h;startDate=e=$.jkj.util.date.getTodayStr(),h=!1,c={locale:{applyLabel:"选择",cancelLabel:"清除",fromLabel:"起始时间",toLabel:"结束时间",weekLabel:"周",customRangeLabel:"自定义范围",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},startDate:startDate,endDate:e,startElementName:"beginDate",endElementName:"endDate",showDropdowns:!0,maxDate:"2250-01-01",format:"YYYY-MM-DD",callback:function(a,c){$("#"+f).val(a.format(b.format)),$("#"+g).val(c.format(b.format)),h=!0},cancelHanddle:function(){$(a).val(""),$("#"+f).val(""),$("#"+g).val(""),$(a).blur()},applyHanddle:function(){if(!h){var c=$(a).data("daterangepicker");$("#"+f).val(c.startDate.format(b.format)),$("#"+g).val(c.endDate.format(b.format)),h=!0}$(a).blur()}},d={startElement:function(){return'<input type="hidden" id="'+f+'" name="'+b.startElementName+'" value="">'},endElement:function(){return'<input type="hidden" id="'+g+'" name="'+b.endElementName+'" value="">'}},b=$.extend(!0,c,b),a=a.trim(),a.indexOf("#")<0&&(a="#"+a),f=a.substring(1)+"-"+b.startElementName,g=a.substring(1)+"-"+b.endElementName,$(a).after(d.endElement()),$(a).after(d.startElement()),$(a).daterangepicker(b,b.callback).on("cancel.daterangepicker",function(a){b.cancelHanddle.call(this)}).on("apply.daterangepicker",function(a){b.applyHanddle.call(this)}),$(a).__proto__.clearDate=function(){$(a).val(""),$("#"+f).val(""),$("#"+g).val(""),h=!1}},$.jkj.layer={_init:function(a,b){var c,d,e,f;return e=$.jkj.data.page,f=$.jkj.util,a=a||"layer"+f.random.getLongDateString(),e.layers=e.layers||[],c=function(){this.id=a,this.type=b,this.$zoneElem=null},c.prototype.templates={wrapper:function(a){var b;return b=[],b.push('<div id="'+a+'" tabindex="-1" class="modal fade bs-example-modal-lg modal-primary in" '),b.push(' \trole="dialog" style="display: block; background-color:rgba(0,0,0,0.2)">'),b.push('\t<div class="modal-dialog modal-lg">'),b.push('\t\t<div class="modal-content" style="border:none;box-shadow:none;background:none;"></div>'),b.push("\t</div>"),b.push("</div>"),b.join("\n")},loadingContent:function(a,b){var c;return c=[],c.push('<div class="modal-body">'),c.push('\t<div style="text-align:center;">'),c.push('\t\t<div class="'+b+'"></div>'),c.push("\t\t<br/>"),c.push('\t\t<span id="loading-message" style="color:white">'+a+"</span>"),c.push("\t</div>"),c.push("</div>"),c.join("\n")},loadingZoneContent:function(a,b,c,d){var e;return e=[],e.push('<div id="'+a+'" style="background-color:rgba(0,0,0,0.2);position:absolute;top:0;left:0;z-index:10;width:100%;height:100%;">'),e.push('\t<div style="text-align:center;padding:20px 0;">'),e.push('\t\t<div class="'+c+'"></div>'),e.push("\t\t<br/>"),e.push('\t\t<span id="loading-message" style="color:white">'+b+"</span>"),e.push("\t</div>"),e.push("</div>"),e.join("\n")}},c.prototype.close=function(){var a;if($("body").find("#"+this.id).remove(),$(e.layers).each(function(b,c){if(c.id===this.id)return a=b,!1}),$(e.layers).splice(a,1),"page"===this.type){var b=!1;$(e.layers).each(function(a,c){if("page"===this.type)return b=!0,!1}),b||$("html").css("overflow-y","auto")}else"zone"===this.type&&this.$zoneElem.css("min-height",this.$zoneElem.data("min-height"))},c.prototype.setMessage=function(a){$("body").find("#"+this.id+" #loading-message").html(a)},d=new c,e.layers.push(d),d},get:function(a){var b,c;return b=null,c=$.jkj.data.page.layers||[],$(c).each(function(c,d){if(d.id===a)return b=d,!1}),null==b&&(window.parent!==window.self&&(c=window.parent.window.$.jkj.data.page.layers||[],$(c).each(function(c,d){if(d.id===a)return b=d,!1})),null==b&&window.top!==window.self&&window.top!==window.parent&&(c=window.top.window.$.jkj.data.page.layers||[],$(c).each(function(c,d){if(d.id===a)return b=d,!1}))),b},loading:function(a,b,c){var d,e;return a=a||"",b=b||"layer-loading",d=this._init(c,"page"),e=d.templates.wrapper(d.id),$("body").append(e),$("body").find("#"+d.id+" .modal-content").append(d.templates.loadingContent(a,b)),d},loadingZone:function(a,b,c,d){var e,f;return a.css("position","relative"),a.data("min-height",a.css("min-height")),a.css("min-height","200px"),b=b||"",c=c||"layer-loading",e=this._init(d,"zone"),e.$zoneElem=a,f=e.templates.loadingZoneContent(e.id,b,c,a),a.append(f),e},mask:function(a){var b,c;return b=this._init(a,"page"),c=b.templates.wrapper(b.id),$("body").append(c),b},maskParent:function(a){var b;return b=window.parent===window.self?this:window.parent.window.$.jkj.layer,b.mask(a)},maskTop:function(a){var b;return b=window.top===window.self?this:window.top.window.$.jkj.layer,b.mask(a)},remove:function(a){var b;b=this.get(a),null!=b&&b.close()},removeAll:function(){var a;a=$.jkj.data.page.layers||[],$(a).each(function(a,b){b.close()}),window.parent!==window.self&&(a=window.parent.window.$.jkj.data.page.layers||[],$(a).each(function(a,b){b.close()})),window.top!==window.self&&window.top!==window.parent&&(a=window.top.window.$.jkj.data.page.layers||[],$(a).each(function(a,b){b.close()}))},setMessage:function(a,b){var c;c=this.get(a),c.setMessage(b)}},$.fn.loadWithZoneLayer=function(a,b,c,d){if(0!==$(this).length){var e;return"boolean"!=typeof d&&(d=!0),e=$.jkj.layer.loadingZone($(this),"数据加载中..."),0==$(this).find(".layer-content").length&&$(this).prepend('<div class="layer-content"></div>'),$(this).find(".layer-content").load(a,b,function(a,b,f){c?d?(c.call(this,a),e.close()):c.call(this,a,e):e.close()}).error(function(){e.setMessage("系统加载失败...")})}},$.fn.loadWithPageLayer=function(a,b,c,d){if(0!==$(this).length){var e;return"boolean"!=typeof d&&(d=!0),e=$.jkj.layer.loading("数据加载中..."),$(this).load(a,b,function(a,b,f){c?d?(c.call(this,a),e.close()):c.call(this,a,e):e.close()}).error(function(){e.setMessage("系统加载失败...")})}},$.jkj.modal=function(){function a(a,b,c){return l({title:"操作提示",width:"450px",content:a,buttons:[{label:"取消",cssClass:"btn-cancel",hotKey:"cancel",action:function(a){c instanceof Function&&c()}},{label:"确定",cssClass:"btn-primary",hotKey:"cancel",action:function(a){b instanceof Function&&b()}}]})}var b=[],c={id:null,cssClass:"",header:!0,footer:!0,title:"标题",width:null,content:null,backdrop:"static",keyboard:!0,buttons:[{label:"取消",cssClass:"btn-cancel",hotKey:"cancel",action:function(a){}},{label:"确定",cssClass:"btn-primary",action:function(a){}}]},d=function(a){var b=$('<div class="modal fade" role="dialog" aria-hidden="true"></div>');return b.addClass(a.cssClass),b.prop("id",a.id),b.attr("aria-labelledby",a.id+"_title"),b},e=function(a){var b=$('<div class="modal-dialog" role="document"></div>');return a.width&&b.css("width",a.width),b},f=function(a){var b=$('<div class="modal-content"></div>');return b.append($('<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>')),b},g=function(a,b){var c=a.content,d=null,e={type:"GET",dataType:"html",beforeSend:null,async:!1,layer:!1,layerMessage:"加载中...",error:function(a,b,c){var d="错误信息:"+b+",捕获的异常对象:"+c;$.jkj.notify.showError(d,{z_index:1199}),e.layer&&f&&f.close()}};$.extend(!0,e,c,!0);var f;e.layer&&(f=$.jkj.layer.loadingZone($("#"+a.id).find(".modal-dialog"),e.layerMessage));var g=c.success;c.fail;return e.success=function(c,h,i){e.async?b.parents("#"+a.id).on("shown.bs.modal",function(){d=c,j(a,d),"function"==typeof g&&g($("#"+a.id)),e.layer&&f&&f.close()}):(d=c,e.layer&&f&&f.close())},!(e.beforeSend&&!e.beforeSend())&&($.ajax(e),$(d))},h=function(a){if(a.header){var b=$('<div class="modal-header"></div>'),c=$('<h4 class="modal-title"></h4>');return c.append(a.title),c.prop("id",a.id+"_title"),b.append(c),b}},i=function(a){var b=$('<div class="modal-body"></div>'),c="";return"function"==typeof a.content?c=a.content.call(this):"string"==typeof a.content?c=a.content:!(a.content instanceof Array)&&a.content instanceof Object&&(c=g(a,b)),b.append(c)},j=function(a,b){var c=$("#"+a.id).find(".modal-body");c.append($(b))},k=function(a){if(!a.footer)return $("");var b=$('<div class="modal-footer"></div>');return"false"===a.buttons?b:(a.buttons instanceof Array&&$.each(a.buttons,function(c,d){var e=$('<button type="button" class="btn"></button>');e.html(d.label),e.addClass(d.cssClass),"cancel"===d.hotKey&&e.attr("data-dismiss","modal"),e.click(function(){d.action instanceof Function&&d.action($("#"+a.id))}),b.append(e)}),b)},l=function(a){var g,j={};j=$.extend(!0,j,c),j.remote=!0,a=$.extend(j,a),a.id=$.jkj.util.random.getLongDateString();var l=f(a).append(h(a)).append(i(a)).append(k(a)),m=d(a).append(e(a).append(l));return g=m.modal(a),b.push(g),n(a,m),g},m=function(a,b){var d,e={};return e=$.extend(!0,e,c),b=$.extend(e,b),d=$(a).modal(b)},n=function(a,b){$(b).on("hidden.bs.modal",function(a){0==$("body > .modal.in").length?$(b).remove():($(b).remove(),$("body").addClass("modal-open"))}),$(b).on("shown.bs.modal",function(){if(!a.async){var b=a.content.success;"function"==typeof b&&b($("#"+a.id))}})},o=function(a){void 0===a||null==a?$.each(b,function(a,b){$(b).modal("hide")}):$(a).modal("hide")};return{show:function(a){return l(a)},showLocalModal:function(a,b){return m(a,b)},confirm:function(b,c,d){return a(b,c,d)},hide:function(a){o(a)}}}(),$.jkj.notify={_init:function(a,b,c){var d,e,f;if(!$.notify)throw new Error("$.jkj.notify 依赖 bootstrap-notify");return f={offset:{x:15,y:5},spacing:2,template:'<div data-notify="container" class="col-xs-11 col-sm-3 alert alert-{0} alert-dismissible" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss">×</button><span data-notify="icon"></span> <span data-notify="title">{1}</span> <span data-notify="message">{2}</span><div class="progress" data-notify="progressbar"><div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div></div><a href="{3}" target="{4}" data-notify="url"></a></div>'},e=$.notify,"self"!==c&&("parent"===c?window.parent!==window.self&&(e=window.parent.window.$.notify):"top"===c?window.top!==window.self&&(e=window.top.window.$.notify):"opener"===c&&window.top===window.self&&null!=window.opener&&(e=window.opener.window.$.notify)),b=$.extend(!0,f,b),d=e(a,b)},showError:function(a,b,c){var d,e;return c=c||"self",e={type:"danger",delay:0},b=$.extend(!0,e,b),d=this._init(a,b,c)},showInfo:function(a,b,c){var d,e;return c=c||"self",e={type:"info",delay:3e3},b=$.extend(!0,e,b),d=this._init(a,b,c)},showSuccess:function(a,b,c){var d,e;return c=c||"self",e={type:"success",delay:3e3},b=$.extend(!0,e,b),d=this._init(a,b,c)},showWarning:function(a,b,c){var d,e;return c=c||"self",e={type:"warning"},b=$.extend(!0,e,b),d=this._init(a,b,c)}},$.jkj.richNavTabs=function(a){var b,c,d;return b=$.jkj.data.app,b.richNavTabs=b.richNavTabs||[],c=function(a){this.infos={navTabs:[]},this.options=$.extend(!0,this.core.settings,a||{}),this.id=this.options.id,this.$elem=null,this.currentTabId=null,this.navTabsCount=function(){return this.infos.navTabs.length}},c.prototype.core={settings:{id:"#pageTabs",showNavTab:null,backward:".nav-control-backward",forward:".nav-control-forward",canHidenNavControl:!1,tabsScroll:".nav-tabs-wrapper",subHeight:77,windowResize:!0,sortHandle:null},templates:{init:function(){var a=[];return a.push('<section class="content-header">'),a.push('\t<div class="navbar nav-control nav-control-backward">'),a.push('\t\t<span class="glyphicon glyphicon-step-backward"></span>'),a.push("\t</div>"),a.push('\t<div class="navbar nav-control nav-control-forward">'),a.push('\t\t<span class="glyphicon glyphicon-step-forward"></span>'),a.push("\t</div>"),a.push("\t<!-- Nav tabs -->"),a.push('\t<div class="nav-tabs-wrapper">'),a.push('\t\t<ul class="nav nav-tabs">'),a.push("\t\t</ul>"),a.push("\t</div>"),a.push("</section>"),a.push('<section class="content">'),a.push("\t<!-- Tab panes -->"),a.push('\t<div class="tab-content">'),a.push("\t</div>"),a.push("</section>"),a.join("\n")},navTab:function(a){var b,c=[];return c.push("<li>"),b='\t<a href="#'+a.id+'" ',a.fullTitle.length>0&&(b+=' title="'+a.fullTitle+'" '),b+=' data-pageType="'+a.pageType+'" ',b+="page"===a.pageType?' data-src="'+a.src+'" ':' data-contentHandle="'+a.contentHandle+'" ',b+=' data-toggle="tab">',c.push(b),c.push("  \t\t<span>"+a.title+"</span>"),a.canClose&&c.push('  \t\t<span class="nav-tabs-close fa fa-close"></span>'),c.push(" \t</a>"),c.push("</li>"),c.join("\n")},tabContent:function(a){var b=[];return b.push('<div class="tab-pane" id="'+a+'">'),b.push("</div>"),b.join("\n")},iframe:function(a,b){var c=[];return c.push('<iframe id="frame-'+a+'" src="'+b+'" border="0" marginheight="0" '),c.push('\t\tmarginwidth="0" frameborder="0" align=left style="width: 100%; height:100%; margin:0; padding: 0;">'),c.push("</iframe>"),c.join("\n")},contextMenu:function(){var a=[];return a.push('<div class="contextMenu">'),a.push("\t<ul>"),a.push('\t\t<li id="close">关闭</li>'),a.push('\t\t<li id="closeOthers">关闭其他</li>'),a.push('\t\t<li id="closeAll">全部关闭</li>'),a.push('\t\t<li id="refresh">刷新</li>'),a.push("\t</ul>"),a.push("</div>"),a.join("\n")}},closeNavTab:function(a,b){var c,d,e,f,g,h,i;d=b.core,e=b.infos,f=b.options,c=$.trim($(this).parent().attr("href")).replace("#",""),g=d.getNavTabInfo(c,e.navTabs),h=b.currentTabId,i=g.item.previousTabId,b.removeNavTab(c),null!=i&&d.getNavTabInfo(i,e.navTabs)?b.displayNavTabById(i):b.displayDefaultNavTab(f),
h===i&&d.setScrollLeft(b)},getNavTabInfo:function(a,b){var c=null;return $.each(b,function(b,d){if(d.id===a)return c={},c.index=b,c.item=d,!1}),c},getNavTabsWidth:function(a){return a.find(".nav-tabs").width()},getTabsScrollLeftLength:function(a,b){return a.find(b.tabsScroll).scrollLeft()},getTabsScrollWidth:function(a,b){return a.find(b.tabsScroll).width()},moveScroll:function(a,b,c,d){var e,f,g,h,i,j,k,l,m;e=this.getTabsScrollLeftLength(a,d),h=this.getNavTabsWidth(a),i=this.getTabsScrollWidth(a,d),g=i/4,j=h-i,k=$(d.id+" "+d.backward),l=$(d.id+" "+d.forward),m=$(d.id+" "+d.tabsScroll),"backward"===b?(f=e-g,f=f<0?0:f):"forward"===b&&(f=e+g,f=f>j?j:f),this.toggleNavControl(a,d,f,j),m.scrollLeft(f)},navTabShownHanddle:function(a,b){var c,d,e,f;if(d=b.core,e=b.infos,c=$.trim($(a.target).attr("href")).replace("#",""),f=d.getNavTabInfo(c,e.navTabs),b.currentTabId=c,void 0!==a.relatedTarget&&(f.item.previousTabId=$.trim($(a.relatedTarget).attr("href")).replace("#","")),"page"===f.item.pageType)if(f.item.firstDisplay)f.item.firstDisplay=!1;else{var g=b.$elem.find(".tab-content").find("#frame-"+c);g&&($(g[0].contentDocument.body).css("overflow-x",""),setTimeout(function(){$(g[0].contentDocument.body).css("overflow-x","auto")},10))}d.setScrollLeft(b)},resize:function(a,b){var c,d,e,f,g;b.windowResize&&(c=a.find(".content-header").outerHeight(),d=a.outerHeight(),e=a.height(),f=parseInt((a.css("height")||"0").replace("px","")),g=$(window).height(),a.find(".tab-content,.tab-content .tab-pane, .tab-content .tab-pane iframe").css("height",g-b.subHeight))},setScrollLeft:function(a){var b,c,d,e,f,g,h,i,j,k;b=a.core,c=a.infos,d=a.options,j=a.$elem,e=b.getNavTabInfo(a.currentTabId,c.navTabs),g=this.getNavTabsWidth(j),h=b.getTabsScrollWidth(j,d),i=g-h,i>0&&(k=$(d.id+" "+d.tabsScroll),f=$(d.id+" .nav-tabs li:eq("+e.index+")").offset().left-$(d.id+" .nav-tabs li:eq(0)").offset().left,f=f<0?0:f,f=f>i?i:f,k.scrollLeft(f)),b.toggleNavControl(j,d,f,i)},toggleNavControl:function(a,b,c,d){var e,f;e=a.find(b.backward),f=a.find(b.forward),d>0?b.canHidenNavControl?(0===c?e.hide():e.show(),c===d?(f.css("visibility","hidden"),f.show()):(f.css("visibility","visible"),f.show())):(e.show(),f.show()):(e.hide(),f.hide())},toggleContextMenu:function(a,b){var c,d,e,f,g,h,i,j;c=b.core,d=b.infos,e=b.options,g=$.trim($(this).attr("href")).replace("#",""),h=c.getNavTabInfo(g,d.navTabs),i=b.$elem,0===i.find(".contextMenu").length&&(i.append(c.templates.contextMenu()),f=!0),j=i.find(".contextMenu"),j.attr("data-tabId",g),f&&(j.bind("mouseleave",function(a){a.preventDefault(),$(this).hide(),j.css("left",-500).css("top",-500)}),j.find("#close").click(function(a){var c;a.preventDefault(),j.hide(),c=j.attr("data-tabId"),b.removeNavTab(c)}),j.find("#closeOthers").click(function(a){var c=j.attr("data-tabId");a.preventDefault(),j.hide(),b.removeOthersNavTab(c)}),j.find("#closeAll").click(function(a){a.preventDefault(),j.hide(),b.removeAllNavTab()}),j.find("#refresh").click(function(a){var c=j.attr("data-tabId");a.preventDefault(),j.hide(),b.refreshNavTab(c)})),h.item.canClose?j.find("#close, #closeOthers").show():j.find("#close, #closeOthers").hide(),j.css("left",a.pageX+2).css("top",a.pageY+2),j.show(),j.focus()}},c.prototype.addNavTab=function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q;"boolean"!=typeof e&&(e=!0),"string"!=typeof f&&(f=""),h=i=this,j=i.core,k=i.options,l=i.infos,o=this.$elem,null==j.getNavTabInfo(a,l.navTabs)?(m={},n=j.templates,p=o.find(".nav-tabs"),q=o.find(".tab-content"),m.id=a,m.title=b,m.fullTitle=f,m.pageType=c,"page"===c?m.src=d:m.contentHandle=d,m.canClose=e,m.closeHandle=g,m.previousTabId=null,m.firstDisplay=!0,p.append(n.navTab(m)),"page"===c?q.append($(n.tabContent(a)).append(n.iframe(a,d))):d.length>0?q.append($(n.tabContent(a)).append(window[d]())):q.append($(n.tabContent(a))),l.navTabs.push(m),o.find('.nav-tabs li:last a[data-toggle="tab"]').tab("show")):this.displayNavTabById(a),j.resize(o,k)},c.prototype.displayDefaultNavTab=function(a){var b;b=this.$elem,null==a.showNavTab?b.find(".nav-tabs li:eq(0) a").tab("show"):b.find(a.showTab).tab("show")},c.prototype.displayNavTabById=function(a){var b;b=this.$elem,b.find('.nav-tabs a[href="#'+a+'"]').tab("show")},c.prototype.refreshNavTab=function(a){var b,c,d,e,f,g,h,i;if(b=this,c=this.core,d=this.options,e=this.infos,h=this.$elem,i=h.find(".tab-content"),g=c.getNavTabInfo(a,e.navTabs),f=g.item,"page"===f.pageType){var j;j=i.find("#frame-"+f.id),j.attr("src",f.src)}else{var k;k=i.find("#"+f.id),k.empty(),"string"==typeof f.contentHandle&&f.contentHandle.length>0&&k.append(window[f.contentHandle]())}},c.prototype.setCallbackData=function(a,b){var c,d,e,f,g,h,i,j;c=this,d=c.core,e=c.options,f=c.infos,h=this.$elem,i=h.find(".nav-tabs"),j=h.find(".tab-content"),g=d.getNavTabInfo(a,f.navTabs),null!=g&&(g.item.callbackData=b())},c.prototype.removeNavTab=function(a){var b,c,d,e,f,g,h,i,j;b=this,c=b.core,d=b.options,e=b.infos,h=this.$elem,i=h.find(".nav-tabs"),j=h.find(".tab-content"),g=c.getNavTabInfo(a,e.navTabs),null!=g&&(f=g.item,e.navTabs.splice(g.index,1),i.find('a[href="#'+a+'"]').parent().remove(),j.find("#"+a).remove(),f.closeHandle&&"function"==typeof f.closeHandle&&f.closeHandle.call(this,f.callbackData))},c.prototype.removeAllNavTab=function(){var a,b,c,d,e,f,g,h;a=this,b=this.core,c=this.options,d=this.infos,e=[],f=this.$elem,g=f.find(".nav-tabs"),h=f.find(".tab-content"),d.navTabs=$.grep(d.navTabs,function(a,b){return!a.canClose||(e.push(a),!1)}),$.each(e,function(a,b){g.find('a[href="#'+b.id+'"]').parent().remove(),h.find("#"+b.id).remove()}),this.displayDefaultNavTab(c)},c.prototype.removeOthersNavTab=function(a){var b,c,d,e,f,g,h,i;b=this,c=this.core,d=this.options,e=this.infos,f=[],g=this.$elem,h=g.find(".nav-tabs"),i=g.find(".tab-content"),e.navTabs=$.grep(e.navTabs,function(b,c){return!b.canClose||b.id==a||(f.push(b),!1)}),$.each(f,function(a,b){h.find('a[href="#'+b.id+'"]').parent().remove(),i.find("#"+b.id).remove()}),this.displayNavTabById(a)},c.prototype.init=function(){var a,b,c,d,e,f,g,h;a=b=this,c=this.core,d=this.options,e=this.infos,f=this.$elem=$(d.id),f.addClass("richNavTabs"),f.append(c.templates.init()),g=f.find(d.backward),h=f.find(d.forward),f.init.prototype.richNavTabs=a,f.find(".nav-tabs").on("contextmenu","li",function(a){if(3==a.which)return!1}),f.find(".nav-tabs").on("mousedown",'a[data-toggle="tab"]',function(b){b.preventDefault(),1==b.which?$(this).tab("show"):3==b.which&&c.toggleContextMenu.call(this,b,a)}),f.find(".nav-tabs").on("shown.bs.tab",'a[data-toggle="tab"]',function(b){b.preventDefault(),c.navTabShownHanddle.call(this,b,a)}),f.find(".nav-tabs").on("click",".nav-tabs-close",function(b){b.preventDefault(),c.closeNavTab.call(this,b,a)}),f.find(".nav-tabs").on("dblclick","li",function(a){a.preventDefault(),$(this).find(".nav-tabs-close").click()}),d.sortHandle&&f.find(".nav-tabs")[d.sortHandle]({axis:"x",distance:20,items:"> li",opacity:.6,scroll:!1}),g.click(function(a){c.moveScroll(f,"backward",e,d)}),h.click(function(a){c.moveScroll(f,"forward",e,d)}),$(window,d.id).resize(function(){var a,b,e,g;a=c.getTabsScrollLeftLength(f,d),b=c.getNavTabsWidth(f),e=c.getTabsScrollWidth(f,d),g=b-e,c.toggleNavControl(f,d,a,g),c.resize(f,d)}),this.displayDefaultNavTab(d)},d=new c(a),d.init(),b.richNavTabs.push(d),d},$.jkj.richNavTabs.get=function(a){var b,c;return b=$.jkj.data.app.richNavTabs,$(b).each(function(b,d){if(d.options.id===a)return c=d,!1}),c},$.jkj.select2={_init:function(a,b){if(void 0===$.fn.select2||null==$.fn.select2)throw new Error("$.jkj.select2 init error");var c=$(a).select2(b);return c},local:function(a,b){var c={placeholder:"请选择",allowClear:!0,language:"zh-CN",defaultSelected:!1};$.extend(!0,c,b);var d=this._init(a,c);return c.defaultSelected||d.val(0).trigger("change"),d},remote:function(a,b){var c=this._init(a,{}),d=b.ajax.url,e=b.ajax.extra,f=b.ajax.success;return delete b.ajax,$.getJSON(d,e,function(a){var d={placeholder:"请选择",allowClear:!0,language:"zh-CN",defaultSelected:!1};$.extend(!0,d,b),d.data=a.list,c.select2(d),d.defaultSelected||c.val(0).trigger("change"),$.isFunction(f)&&f.call(this)}),c},autocomplete:function(a,b){var c={ajax:{url:"select2.json",dataType:"json",delay:300,extra:{},data:function(a){var b={};return b[c.paramName]=a.term,c.pageable&&(b.pageNumber=a.page||1,b.pageSize=c.pageSize),b},processResults:function(a,b){var d={};return d.results=a.list,c.pageable&&(b.page=b.page||1,d.pagination={},d.pagination.more=b.page*a.page.pageSize<a.page.total),d},cache:!0},escapeMarkup:function(a){return a},allowClear:!0,pageable:!1,language:"zh-CN",placeholder:"请选择",pageSize:20,minimumInputLength:1,maximumSelectionLength:50,textFiled:"text",paramName:"search",formatResult:null,formatSelection:null,templateResult:function(a){if(a.loading)return"正在加载...";if(!c.formatResult)return a[c.textFiled];for(var b=c.formatResult.match(/{\w+}/g),d=c.formatResult,e=0;e<b.length;e++)d=d.replace(b[e],a[b[e].substring(1,b[e].length-1)]);return d},templateSelection:function(a){if(""===a.id)return a.text;if(!c.formatSelection)return a[c.textFiled];for(var b="string"==typeof c.formatSelection?c.formatSelection:$.isFunction(c.formatSelection)?c.formatSelection(a):"",d=b.match(/{\w+}/g),e=0;e<d.length;e++)b=b.replace(d[e],a[d[e].substring(1,d[e].length-1)]);return b}};$.extend(!0,c,b);var d=this._init(a,c);return d}},$(function(){$(".sidebar-toggle").click(function(){var a=$("body").hasClass("sidebar-collapse");a?($(this).find(".fa-caret-left").show(),$(this).find(".fa-caret-right").hide()):($(this).find(".fa-caret-left").hide(),$(this).find(".fa-caret-right").show())})}),function(a){function b(){var b=e("skin");b&&a.inArray(b,f)&&c(b);var d=0,g=0;switch(a("[data-skin]").on("click",function(b){var d=a("input[name='changeColor']:checked").val(),e=a("input[name='changeMode']:checked").val();"default"==d?c("default"==e?"skin-blue":"yellow"==e?"skin-blue-protect":"skin-blue-protect2"):"business"==d&&c("default"==e?"skin-dark-gray":"yellow"==e?"skin-dark-gray-protect":"skin-dark-gray-protect2")}),b){case"skin-blue":d=0,g=0;break;case"skin-blue-protect":d=0,g=1;break;case"skin-blue-protect2":d=0,g=2;break;case"skin-dark-gray":d=1,g=0;break;case"skin-dark-gray-protect":d=1,g=1;break;case"skin-dark-gray-protect2":d=1,g=2}a("input[name='changeColor']").eq(d).attr("checked","checked"),a("input[name='changeMode']").eq(g).attr("checked","checked")}function c(b){return a.each(f,function(b){a("body").removeClass(f[b]),a("iframe").contents().find("body").removeClass(f[b])}),a("body").addClass(b),a("iframe").contents().find("body").addClass(b),d("skin",b),!1}function d(a,b){"undefined"!=typeof Storage?localStorage.setItem(a,b):window.alert("Please use a modern browser to properly view this template!")}function e(a){return"undefined"!=typeof Storage?localStorage.getItem(a):void window.alert("Please use a modern browser to properly view this template!")}var f=["skin-blue","skin-black","skin-red","skin-yellow","skin-purple","skin-green","skin-blue-light","skin-black-light","skin-red-light","skin-yellow-light","skin-purple-light","skin-green-light","skin-blue-protect","skin-blue-protect2","skin-dark-gray","skin-dark-gray-protect","skin-dark-gray-protect2"];b()}(jQuery),$.jkj.initForm=function(a){$(a).find(":text").keydown(function(a){var b=a.keyCode|a.charCode;13==b&&a.preventDefault()}),$.jkj.validate(a,{submitHandler:function(a){}})},$.jkj.submit=function(a){var b,c,d,e,f,g,h;return e=$(a.btn),e.button("loading"),void 0===e.attr("data-loading-text")&&e.attr("data-loading-text",e.text()+"中"),b=$.jkj.layer.loading("页面处理中..."),f=$(a.form),g=a.beforeSend,h=function(){b&&b.close(),e&&e.button("reset")},c={url:f.attr("action"),type:"post",data:f.serializeArray(),context:a.btn,success:function(a,b,c){$(this)},error:function(){$.jkj.notify.showError("服务器错误，请联系管理员",null,"self")},complete:function(a,b){h()}},d={options:a,settings:c,formLayer:b},a.validate&&!f.valid()?(h(),!1):(a.callback&&(c.success=a.callback),g&&g(d)===!1?(h(),!1):(b.setMessage("保存中..."),void $.ajax(c)))},$.fn.jkjSubmit=function(a){a.form=this,$.jkj.submit(a)},$.jkj.wonderForm=function(a,b){this.settings=$.extend(!0,{},$.jkj.wonderForm.defaults,a),this.form=b,this.lastValidationModel="",this.beautifyInput=null,this.validator=null,this.init()},$.extend($.jkj.wonderForm,{defaults:{enableBeautifyInput:!1,enableEnterKey:!1,enableValidate:!0,enableTrim:!0,enableDynamicRules:!1,dynamicRules:"data-rules",validationModel:"data-validation-model",validate:{},submit:{url:null,type:"post",beforeSend:null,successCallBack:null,errorCallBack:null,completeCallBack:null}},setDefaults:function(a){$.extend($.jkj.wonderForm.defaults,a)},prototype:{init:function(){var a=this,b=a.settings,c=a.form;b.enableEnterKey||$(c).find(":text").keydown(function(a){var b=a.keyCode|a.charCode;13==b&&a.preventDefault()}),b.enableTrim&&$(c).find(":text, textarea").blur(function(a){a.preventDefault(),$(this).val($.trim($(this).val()))}),b.enableBeautifyInput&&(a.beautifyInput=new $.jkj.beautifyInput({},c)),b.enableValidate&&(a.validator=$.jkj.validate(c,b.validate))},submit:function(submitButton){var _root=this,form=_root.form,settings=_root.settings,ajaxData,formLayer,submitContext,validationModel,addRules,renew;return submitButton&&$(submitButton).attr("disabled","disabled"),formLayer=$.jkj.layer.loading("页面处理中..."),validationModel=$(form).attr(settings.validationModel)||"draft",renew=function(){submitButton&&$(submitButton).removeAttr("disabled"),settings.enableDynamicRules&&"submit"===validationModel&&$(form).find("["+settings.dynamicRules+"]").each(function(){var rules=$(this).attr(settings.dynamicRules);if(0===rules.indexOf("{")){var removeRules="";$.each(eval("("+rules+")"),function(a,b){removeRules+=a})}$(this).rules("remove",removeRules)}),formLayer&&formLayer.close()},settings.enableDynamicRules&&"submit"===_root.lastValidationModel&&$(form).find("["+settings.dynamicRules+"]").each(function(){var a=$(this).parent().attr("aria-describedby");a&&$("#"+a).remove(),$(this).removeAttr("aria-invalid").removeAttr("aria-describedby")}),_root.lastValidationModel=validationModel,settings.enableDynamicRules&&"submit"===validationModel&&$(form).find("["+settings.dynamicRules+"]").each(function(){var rules=$.trim($(this).attr(settings.dynamicRules));0===rules.indexOf("{")&&$(this).rules("add",eval("("+rules+")"))}),settings.enableValidate&&!$(form).valid()?(renew(),!1):(ajaxData=$(form).serializeArray(),submitContext={ajaxData:ajaxData,formLayer:formLayer,settings:settings,submitButton:submitButton,renew:renew},settings.submit.beforeSend&&settings.submit.beforeSend(submitContext)===!1?(renew(),!1):(formLayer.setMessage("发送请求中..."),void $.ajax({url:settings.submit.url||$(form).prop("action"),type:settings.submit.type,data:ajaxData,success:function(a,b,c){var d=settings.submit.successCallBack;d&&d.call(submitContext,a,b,c)},error:function(a,b,c){var d=settings.submit.errorCallBack;d?d.call(submitContext,b,a,c):$.jkj.notify.showError("服务器错误，请联系管理员",null,"self")},complete:function(a,b){var c=settings.submit.completeCallBack;c?c.call():renew()}})))}}}),$.jkj.tree=function(a,b){var c;c={core:{themes:{responsive:!1},strings:{"Loading ...":"加载中 ...","New node":"新增节点"},check_callback:!1,error:function(a){console&&console.log(a)},animation:200,multiple:!0,expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},types:{default:{icon:"fa fa-folder icon-state-warning icon-lg"},file:{icon:"fa fa-file icon-state-warning icon-lg"}},search:{fuzzy:!1,case_sensitive:!1,show_only_matches:!0,show_only_matches_children:!0,close_opened_onclear:!0,search_leaves_only:!1},contextmenu:{items:function(a,b){var c=$.jstree.defaults.contextmenu.items();return c.rename.label="修改",c.create.label="新增",c.remove.label="删除",c.ccp.label="编辑",c.ccp.submenu.copy.label="复制",c.ccp.submenu.cut.label="剪切",c.ccp.submenu.paste.label="粘贴",c}},plugins:["types"]},b=$.extend(!0,c,b),$(a).jstree(b)},$.jkj.treeTable=function(a,b){var c,d;return d={branchAttr:"ttBranch",clickableNodeNames:!1,column:0,columnElType:"td",expandable:!0,expanderTemplate:'<a href="#">&nbsp;</a>',indent:"19",indenterTemplate:'<span class="indenter"></span>',initialState:"collapsed",nodeIdAttr:"ttId",parentIdAttr:"ttParentId",stringCollapse:"关闭",stringExpand:"展开"},b=$.extend(!0,d,b),c=$(a).treetable(b)},$.fn.serializeObject=function(){var a={},b=this.serializeArray();return $.each(b,function(){void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a},$.jkj.upload=function(a,b){"use strict";String.prototype.repl=function(a,b){return this.split(a).join(b)};var c=$(a).attr("id"),d="<a class='btn-edit glyphicon glyphicon-edit' id='"+c+"-file-edit' href='javascript:void(0)'>编辑</a>";""!=b.permissionCode&&void 0!=b.permissionCode&&(d="");var e,f,g="<div class='form-title'>{title}<label class='right'>"+d+"</label></div><div class='tabbable'><ul class='nav nav-tabs'>{tabItem}</ul><div class='tab-content'><input type='hidden' name='fileIds' value=''>{tabContent}</div></div>",h="<a class='btn-edit glyphicon glyphicon-upload' id='"+c+"-file-upload' href='javascript:void(0)'>上传附件</a>",i="<div class='btn-submit'><button type='button' class='btn btn-cancel btn-font4'>取消</button><button type='button' class='btn btn-primary' style=''>保存</button></div>",j="<li style='float: left; margin-left: 15px; text-align: center' class='upload'><a href='{downloadUrl}' target='_blank' class='{uploadClass}'><label title='{filename}'>{filename}</label><span data-fileType={fileType} data-fileId={fileId} {styleDisble}></span></a><mark class='bg-green'>传</mark></li>",k="<div class='modal fade fileupload' id='"+c+"-uploadModal' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'><div class='modal-dialog' style='width: 845px;'><div class='modal-content'><div class='modal-header mhd-layer-header'><button class='close' aria-hidden='true' type='button' data-dismiss='modal'>×</button><h4 class='modal-title mhd-layer-title'>上传文件</h4></div><div class='modal-body'><div class='mhd-layer-body'>文件类型：<select class='form-control' id='"+c+"-selectFileType'>{selectObj}</select><form enctype='multipart/form-data'><input class='file' name='files' type='file' multiple style='width: 300px;'></form></div></div></div></div></div>",l={fileServerUrl:"",maxTotalSize:200,files:{},tabs:null,removeFile:function(a){a.preventDefault();var b=$(this).attr("data-fileType"),d=$("#"+c+"-fileCount_"+b).html();$("#"+c+"-fileCount_"+b).html(d-1);var e=$(f).find(".tab-content input");e.val(e.val().repl(","+$(this).attr("data-fileId"),"")),$(this).closest("li").remove()},saveFile:function(){},cancle:function(){},language:"zh",autoReplace:!1,layoutTemplates:{footer:'<div class="file-thumbnail-footer"><div class="file-footer-caption">{caption}</div>{actions}</div>',actions:'<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload} {delete} {zoom} {other}    </div>\n    {drag}\n    <div class="file-upload-indicator" title="{indicatorTitle}">{indicator}</div>\n    <div class="clearfix"></div>\n</div>'},allowedPreviewTypes:[],previewFileIcon:'<div class="upload"><i class="" style="height:auto;"></i></div>',previewFileIconSettings:{pdf:'<div class="upload"><i class="upload-pdf" style="height:auto;"></i></div>',doc:'<div class="upload"><i class="upload-doc" style="height:auto;"></i></div>',docx:'<div class="upload"><i class="upload-doc" style="height:auto;"></i></div>',xls:'<div class="upload"><i class="upload-xls" style="height:auto;"></i></div>',xlsx:'<div class="upload"><i class="upload-xls" style="height:auto;"></i></div>',ppt:'<div class="upload"><i class="upload-ppt" style="height:auto;"></i></div>',jpg:'<div class="upload"><i class="upload-jpg" style="height:auto;"></i></div>',png:'<div class="upload"><i class="upload-png" style="height:auto;"></i></div>'},fileActionSettings:{showUpload:!1,showZoom:!1,showDrag:!1},uploadAsync:!1,showCaption:!0,showPreview:!0,showRemove:!0,showUpload:!0,browseOnZoneClick:!0,minFileSize:0,maxFileSize:10240,minFileCount:0,maxFileCount:20,maxFilePreviewSize:102400,allowedFileTypes:["image","html","text","video","audio","flash","object"],allowedFileExtensions:[],ajaxSettings:{},uploadExtraData:function(){var a={};return a.fileType=$("#"+c+"-selectFileType").val(),a}},m=function(a,b){$.extend(l,b),f=a;var d="",h="",i="";$.each(l.tabs,function(a,b){var e=0===a?"active":"",f=b.fileType,g=b.name;d+="<li class='"+e+"'><a data-toggle='tab' href='#"+c+"-tab"+f+"' id='"+c+"-tabTitle_"+f+"'> "+g+" (<span class='red' id='"+c+"-fileCount_"+f+"'>0</span>)</a></li>",h+="<div id='"+c+"-tab"+f+"' class='tab-pane "+e+"'><ul id='"+c+"-tabContent_"+f+"' data-maxCount="+b.maxCount+" style='list-style: none; margin-left: -40px'></ul><div class='clearfix'></div></div>",i+="<option value='"+f+"'>"+g+"</option>"}),$(f).append(g.repl("{title}",b.title).repl("{tabItem}",d).repl("{tabContent}",h)),void 0===e&&($("body").append(k.repl("{selectObj}",i)),e=$("#"+c+"-uploadModal"));var m="";l.files.length>0&&$.each(l.files,function(a,b){m+=","+b.id;var d=b.fileType,e=$("#"+c+"-tabContent_"+d),g=$("#"+c+"-fileCount_"+d).html();e.append(j.repl("{downloadUrl}",l.fileServerUrl+"/{fileId}/download").repl("{uploadClass}","upload-"+b.extension.repl(".","")).repl("{fileId}",b.id).repl("{fileType}",d).repl("{filename}",b.filename).repl("{styleDisble}","style='display:none !important;'")),$("#"+c+"-fileCount_"+d).html(parseInt(g)+1),$(f).find(".tab-content input").val(m),e.find("span").off("click").on("click",l.removeFile)})},n=function(a){var b=$("#"+c+"-file-edit");b.off("click").on("click",function(){$(this).parent().append(h);var a=$("#"+c+"-file-upload");a.off("click").on("click",function(){var a=$(f).find(".active").find("a").attr("href").repl("#"+c+"-tab","");$("#"+c+"-selectFileType").val(a),e.modal("show")}),$(f).append(i);var b=$(f).find(".btn-cancel");b.off("click").on("click",function(){l.cancle(),$(this).parent().remove(),$("#"+c+"-file-upload").remove(),$("#"+c+"-file-edit").show(),$(f).find(".tab-content span").attr("style","display:none !important")});var d=$(f).find(".btn-primary");d.off("click").on("click",function(){l.saveFile(),$(this).parent().remove(),$("#"+c+"-file-upload").remove(),$("#"+c+"-file-edit").show(),$(f).find(".tab-content span").attr("style","display:none !important")}),$(f).find("span").show(),$(this).hide()}),void 0===e&&($("body").append(k).trigger("refresh"),e=$("#"+c+"-uploadModal")),l.uploadUrl=l.fileServerUrl+"?appId="+a.appId+"&moduleId="+a.moduleId;var d=e.find("input");d.fileinput(l),e.off("hidden.bs.modal").on("hidden.bs.modal",function(a){d.fileinput("clear"),d.fileinput("clearStack")}),d.off("filebatchuploaderror").on("filebatchuploaderror",function(a,b,c){console.log("event:"),console.log(a),console.log("errorData:"),console.log(b),console.log("errorMsg:"+c)}),d.off("fileloaded").on("fileloaded",function(a,b,c,d,e){var f="",g=b.name;if(g.indexOf(".")){var d=g.lastIndexOf(".");f=g.substring(0,d).cutString(4)+g.substr(d)}else f=g.cutString(4);$("#"+c).find(".file-footer-caption").html(f)}),d.off("filebatchpreupload").on("filebatchpreupload",function(a,b,d,e){var f=$("#"+c+"-selectFileType").val(),g=$("#"+c+"-tabContent_"+f),h=b.filescount+g.find("li").length,i=g.attr("data-maxCount");if(g.attr("data-maxCount")<h)return{message:"所上传类型附件个数不能超过："+i+"个",data:{}};var j=0;return $.each(b.files,function(a,b){void 0!==b&&(j+=b.size)}),j/1048576>l.maxTotalSize?{message:"所上传附件总大小不能超过："+l.maxTotalSize+"M",data:{}}:void 0}),d.off("filebatchuploadsuccess").on("filebatchuploadsuccess",function(a,b,d,g){var h=$("#"+c+"-selectFileType").val(),i=$("#"+c+"-tabContent_"+h),k=$("#"+c+"-tabTitle_"+h),m="";$.each(b.response.files,function(a,b){m+=","+b.id;var d=$("#"+c+"-fileCount_"+h).html();i.append(j.repl("{downloadUrl}",l.fileServerUrl+"/{fileId}/download").repl("{uploadClass}","upload-"+b.extension.repl(".","")).repl("{fileId}",b.id).repl("{fileType}",h).repl("{filename}",b.filename).repl("{styleDisble}","")),$("#"+c+"-fileCount_"+h).html(parseInt(d)+1)}),$(f).find(".tab-content input").val($(f).find(".tab-content input").val()+m),i.find("span").off("click").on("click",l.removeFile),k.click(),e.modal("hide")})};m(a,b),n(b)},$.fn.upload=function(a){$(this).empty(),$.jkj.upload(this,a)},$.jkj.validate=function(a,b){var c,d,e;if(void 0===$.validator||null==$.validator)throw new Error("$.jkj.validate 依赖 jquery-validation");return d={errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",rules:{},messages:{},onkeyup:!1,tooltipOptions:{tooltip:!0,placement:"top"},highlight:function(a){$(a).closest(".form-group").addClass("has-error")},unhighlight:function(a){$(a).closest(".form-group").removeClass("has-error")},success:function(a){$(a).closest(".form-group").removeClass("has-error")},errorPlacement:function(a,b){var c=b;c=$(b).is(":checkbox")?$(b).parents(".checkbox-list"):$(b).is(":radio")?$(b).parents(".radio-list"):b.parent(),a.appendTo(c)},onfocusin:function(a){this.lastActive=a,this.addWrapper(this.errorsFor(a)).hide();var b=$(a).attr("tip");b&&0===$(a).parent().children(".tip").length&&$(a).parent().append("<label class='tip'>"+b+"</label>"),$(a).addClass("highlight"),this.settings.focusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,a,this.settings.errorClass,this.settings.validClass),this.hideThese(this.errorsFor(a)))},onfocusout:function(a){$(a).parent().children(".tip").remove(),$(a).removeClass("highlight");var b=this;setTimeout(function(){b.element(a)},300)},submitHandler:function(a){}},e=b.submitHandler,d.submitHandler=function(a){return e(a),!1},b=$.extend(!0,d,b),b.tooltipOptions.tooltip&&$.extend(!0,b,{unhighlight:function(a){$(a).closest(".form-group").removeClass("has-error");var b=a;b=$(a).is(":checkbox")?$(a).parents(".checkbox-list"):$(a).is(":radio")?$(a).parents(".radio-list"):$(a).parent(),$(b).tooltip("hide")},errorPlacement:function(a,c){var d=c;d=$(c).is(":checkbox")?$(c).parents(".checkbox-list"):$(c).is(":radio")?$(c).parents(".radio-list"):$(c).parents().hasClass("tip-parent")?$(c).parent():$(c).wrapAll("<div class='tip-parent'></div>").parent(),d.attr("data-original-title",a.text()).attr("data-trigger","manual").attr("data-placement",b.tooltipOptions.placement).tooltip("show")},invalidHandler:function(a,b){if(b.numberOfInvalids()>0){var c=$(b.errorList[0].element),d=-50,e=c&&c.size()>0?c.offset().top:0;c&&(e+=d?d:-1*c.height()),c.parents(".modal").length>0?$(c).parents(".modal").animate({scrollTop:e},"slow"):$("html,body").animate({scrollTop:e},"slow")}}}),c=$(a).validate(b)},$(function(){void 0!==$.validator&&null!=$.validator&&void 0!==$.validator.addMethod&&null!=$.validator.addMethod&&validateAddMethod()}),$.jkj.workbench=function(a,b){var c,d,e,f,g,h=!0,i=[],j=[],k=[],l=[],m=0;if(!GridStackUI)throw new Error("$.jkj.workbench 依赖 gridstack");if(GridStackUI.prototype._updateContainerHeight=function(){if(!this.grid._updateCounter){var a=this.grid.getGridHeight();a<this.opts.minHeight&&(a=this.opts.minHeight),this.container.attr("data-gs-current-height",a),this.opts.cellHeight&&(this.opts.verticalMargin?this.opts.cellHeightUnit===this.opts.verticalMarginUnit?this.container.css("height",a*(this.opts.cellHeight+this.opts.verticalMargin)-this.opts.verticalMargin+this.opts.cellHeightUnit):this.container.css("height","calc("+(a*this.opts.cellHeight+this.opts.cellHeightUnit)+" + "+(a*(this.opts.verticalMargin-1)+this.opts.verticalMarginUnit)+")"):this.container.css("height",a*this.opts.cellHeight+this.opts.cellHeightUnit))}},d={auto:!1,cellHeight:10,draggable:{cursor:"move",opacity:.5,handle:".workbench-widget-header"},itemClass:"grid-stack-item",minHeight:null,width:12,float:!1,removable:!1,scroll:!0,acceptWidgets:".workbench-widget",verticalMargin:5,loadHandle:function(){return[]},saveHandle:function(a){},widgetsExtendInfo:[]},e={operation:function(){var a=[];return a.push('<div class="workbench-operation">'),a.push('\t<button class="workbench-operation-custom">编辑工作台</button>'),a.push('\t<button class="workbench-operation-cancel">退出编辑</button>'),a.push("</div>"),a.join("\n")}},f={dragOptions:{appendTo:"body",cursor:"move",handle:".workbench-widget-header",helper:"clone",opacity:.6,refreshPositions:!0,revert:"invalid",scroll:!1,zIndex:1040,stop:function(c,d){var e=$(this).attr("widget-name"),h=$(this).attr("widget-model"),i=$("."+b.itemClass+'[widget-name="'+e+'"][widget-model="'+h+'"]'),j=i.data("_gridstack_node");if(j){a.data("gridstack").removeWidget(i),d.helper.hide(),a.data("gridstack").addWidget($("<div></div>").append(f.templates.body(e,h)),j.x,j.y,j.width,j.height)}g.empty()}},templates:{body:function(a,b){return'<div class="workbench-widget" widget-name="'+a+'" widget-model="'+b+'"></div>'},wrapper:function(){var a=[];return a.push('<div class="row workbench-bottom-widgets">'),a.push('\t<div class="col-xs-12">'),a.push('\t\t<div class="workbench-widgets-wrapper">'),a.push('\t\t\t<div class="workbench-widgets">'),a.push("\t\t\t</div>"),a.push('\t\t\t<div class="workbench-widgets-empty">'),a.push("\t\t\t</div>"),a.push("\t\t</div>"),a.push("\t</div>"),a.push("</div>"),a.join("\n")}}},g={empty:function(){0===$(".workbench-widgets .workbench-widget").length?($(".workbench-widgets-empty").show(),$(".workbench-widgets").hide()):($(".workbench-widgets-empty").hide(),$(".workbench-widgets").show())}},b=$.extend(!0,d,b),!b.minHeight){var n=400,o=$(".grid-stack").offset().top,p=$(window).height(),q=($(document).height(),$(".workbench-bottom-widgets").outerHeight());p-o-q>400&&(n=p-o-q),b.minHeight=(n+b.verticalMargin)/(b.cellHeight+b.verticalMargin)}a.gridstack(b),c=a.data("gridstack"),l=b.loadHandle();$.each(l,function(d,e){var g;c.addWidget($("<div></div>").append(f.templates.body(e.name,e.model)),e.x,e.y,e.width,e.height),g=a.find('[widget-name="'+e.name+'"][widget-model="'+e.model+'"]'),g[e.name]($.extend(!0,{model:e.model,place:"workbench",extendInfo:b.widgetsExtendInfo},e.others)),g.attr("widget-place","workbench"),j.push(e.name+"=>"+e.model)});return a.find(".workbench-widget-header").css("cursor","initial"),c.disable(),$("body").append(e.operation()),$(".workbench-operation-custom","body").on("click",function(){var c;a.data("gridstack").enable(),$(this).hide(),$(".workbench-operation-cancel, .workbench-operation-save").show(),$(".workbench-bottom-widgets","body").show(),a.find(".workbench-widget-header").css("cursor","move"),a.find(".workbench-widget-close").show(),h&&(h=!1,$("body").append(f.templates.wrapper()),$.each($.jkjWidgets,function(a,c){var d;"__proto__"!==a&&(d=b.widgetsExtendInfo,$.each(d,function(c,d){if(i.push({name:a,model:d.urlCode,sort:m}),$.inArray(a+"=>"+d.urlCode,j)<0){var e;$(".workbench-widgets").append(f.templates.body(a,d.urlCode)),e=$('.workbench-widgets [widget-name="'+a+'"][widget-model="'+d.urlCode+'"]'),e[a]({model:d.urlCode,place:"widgets",extendInfo:b.widgetsExtendInfo}),e.attr("widget-place","widgets"),k.push({name:a,model:d.urlCode,sort:m})}m++}))}),$(".workbench-widgets .workbench-widget").draggable(f.dragOptions),g.empty()),c=$(".workbench-bottom-widgets").outerHeight(),a.data("margin-bottom",a.css("margin-bottom")),a.css("margin-bottom",c+"px")}),$(".workbench-operation-cancel","body").on("click",function(){a.data("gridstack").disable(),a.find(".workbench-widget-header").css("cursor","initial"),$(".workbench-operation-cancel, .workbench-operation-save").hide(),$(".workbench-operation-custom").show(),$(".workbench-bottom-widgets","body").hide(),a.find(".workbench-widget-close").hide(),a.css("margin-bottom",a.data("margin-bottom"))}),a.on("dropover",function(a,b){var c=$(b.draggable),d=c.data("_gridstack_node");d.width=parseInt($(c).attr("data-gs-width")||2),d.height=parseInt($(c).attr("data-gs-height")||2),c.data("_gridstack_node",d)}),a.on("drop",function(a,b){}),a.on("added",function(a,c){$.each(c,function(a,c){var d,e,f;d=$(c.el).find(".workbench-widget"),d.attr("widget-place","workbench"),
e=d.attr("widget-name"),f=d.attr("widget-model"),j.push(e+"=>"+f),$.each(k,function(a,b){if(b.name===e&&b.model===f)return k.splice(a,1),!1}),d[e]({model:f,place:"workbench",extendInfo:b.widgetsExtendInfo}),d.find(".workbench-widget-close").show(),d.find(".workbench-widget-header").css("cursor","move")})}),a.on("change",function(a,c){var d,e=!1;$.each(c,function(a,b){if("widgets"===$(b.el).attr("widget-place"))return e=!0,!1}),e||(d=_.map($(".grid-stack > .grid-stack-item:visible"),function(a){var b=$(a),c=$(a).find(".workbench-widget"),d=c.attr("widget-name"),e=c.attr("widget-model"),f=b.data("_gridstack_node"),g=c[d]("saveWidget")||{};return{x:f.x,y:f.y,width:f.width,height:f.height,name:d,model:e,others:g}}),b.saveHandle(d))}),a.on("click",".workbench-widget-close",function(){var c=$(this).parents(".workbench-widget"),d=c.attr("widget-name"),e=c.attr("widget-model"),h=c[d]("option");"function"==typeof h.closeHandle&&h.closeHandle.call(this),a.data("gridstack").removeWidget(c.parent()),j.splice($.inArray(d+"=>"+e,j),1),$.each(i,function(a,c){if(c.name===d&&c.model===e){var g,h,i=f.templates.body(d,e);if(0===k.length)h=0;else if(1===k.length)h=c.sort<k[0].sort?0:1;else for(var a=0;a<k.length;a++){if(0===a&&c.sort<k[a].sort){h=0;break}if(a===k.length-1&&c.sort>k[a].sort||c.sort>k[a].sort&&c.sort<k[a+1].sort){h=a+1;break}}return 0===h?$(".workbench-widgets").prepend(i):$(".workbench-widgets .workbench-widget:eq("+(h-1)+")").after(i),g=$('.workbench-widgets [widget-name="'+d+'"][widget-model="'+e+'"]'),g.draggable(f.dragOptions),g[d]({model:e,place:"widgets",extendInfo:b.widgetsExtendInfo}),g.attr("widget-place","widgets"),k.splice(h,0,{name:d,model:e,sort:c.sort}),!1}}),g.empty()}),c},$.fn.workbench=function(a){return $.jkj.workbench($(this),a)};